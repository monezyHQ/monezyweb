<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Tax Calculator FY 2025-26 (AY 2026-27)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8; /* Light blue-grey background */
        }
        /* Robinhood Green */
        .bg-robinhood-green { background-color: #00C805; }
        .text-robinhood-green { color: #00C805; }
        .border-robinhood-green { border-color: #00C805; }
        .ring-robinhood-green:focus { ring-color: #00C805; }

        /* UI Elements */
        .input-label {
            color: #374151; /* Gray-700 */
            font-weight: 500;
            margin-bottom: 0.25rem;
            display: block;
            font-size: 0.875rem; /* text-sm */
        }
        .input-field {
            width: 100%;
            padding: 0.6rem 0.75rem; /* Slightly smaller padding */
            border: 1px solid #D1D5DB; /* Gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            background-color: #ffffff;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            font-size: 0.875rem; /* text-sm */
        }
        .input-field:focus {
            outline: none;
            border-color: #00C805;
            box-shadow: 0 0 0 2px rgba(0, 200, 5, 0.2);
        }
        .info-icon {
            display: inline-block;
            width: 0.875rem; /* smaller */
            height: 0.875rem; /* smaller */
            background-color: #9CA3AF; /* Gray-400 */
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 0.65rem; /* smaller */
            line-height: 0.875rem; /* match height */
            cursor: help;
            margin-left: 0.25rem;
            position: relative;
            vertical-align: middle;
        }
        .tooltip {
            visibility: hidden;
            width: 240px; /* Slightly wider */
            background-color: #1F2937; /* Gray-800 */
            color: #fff;
            text-align: left; /* Better for multiline */
            border-radius: 6px;
            padding: 8px 10px; /* More padding */
            position: absolute;
            z-index: 10;
            bottom: 135%; /* Position further above */
            left: 50%;
            margin-left: -120px; /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem; /* text-xs */
            font-weight: normal;
            pointer-events: none; /* Allow clicking through */
        }
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .calculate-button {
            background-color: #00C805; /* Robinhood Green */
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            width: 100%;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .calculate-button:hover {
            background-color: #00A004; /* Darker Green */
        }
         .calculate-button:active {
            transform: scale(0.98);
        }

        /* Result Card Styling */
        .result-card {
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.25rem; /* p-5 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-top: 1rem;
            position: relative; /* For badge positioning */
            overflow: hidden; /* Hide badge overflow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent; /* Placeholder for recommended border */
        }
        .result-card-old { background-color: #f8fafc; } /* Cool Gray 50 */
        .result-card-new { background-color: #ffffff; }

        .result-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 700; /* font-bold */
            margin-bottom: 1rem;
            color: #111827; /* Gray-900 */
            text-align: center;
            border-bottom: 1px solid #e5e7eb; /* Gray-200 */
            padding-bottom: 0.75rem; /* pb-3 */
        }
         .result-recommended {
            border-color: #00C805;
            box-shadow: 0 0 12px rgba(0, 200, 5, 0.3);
        }
        .recommended-badge {
            position: absolute;
            top: -1px; /* Adjust as needed */
            right: -1px; /* Adjust as needed */
            background-color: #00C805;
            color: white;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem; /* text-xs */
            font-weight: 600;
            border-bottom-left-radius: 0.5rem; /* rounded-bl-lg */
            z-index: 5;
        }
        .result-label {
            color: #4B5563; /* Gray-600 */
            font-size: 0.8rem; /* Slightly smaller */
        }
        .result-value {
            color: #111827; /* Gray-900 */
            font-weight: 500; /* font-medium */
            font-size: 0.9rem;
            text-align: right;
        }
        .total-tax-label {
            font-size: 1rem; /* text-base */
            font-weight: 600; /* font-semibold */
            color: #374151; /* Gray-700 */
        }
        .total-tax-value {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #00C805; /* Robinhood Green */
            text-align: right;
        }
        .section-container {
            background-color: white;
            padding: 1.5rem; /* p-6 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .section-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            margin-bottom: 1rem; /* mb-4 */
            color: #1f2937; /* Gray-800 */
            border-bottom: 1px solid #e5e7eb; /* Gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        /* Deduction Grouping */
        .deduction-group-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4b5563; /* Gray-600 */
            margin-top: 1.25rem; /* mt-5 */
            margin-bottom: 0.75rem; /* mb-3 */
            padding-bottom: 0.25rem; /* pb-1 */
            border-bottom: 1px dashed #d1d5db; /* Gray-300 */
        }
        .deduction-group-title:first-of-type {
             margin-top: 0; /* Remove top margin for the first group */
        }
        /* Styles for always expanded deductions section */
        .deductions-content-visible {
             padding-top: 1rem;
             border-top: 1px solid #e5e7eb;
             margin-top: 0.5rem;
        }


        /* Responsive adjustments */
        @media (min-width: 1024px) { /* lg breakpoint */
            .lg\:grid-cols-inputs-results {
                grid-template-columns: minmax(400px, 1fr) 1.3fr; /* Adjust ratio, ensure min width for inputs */
            }
        }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">
                Income Tax Calculator <span class="text-robinhood-green">FY 2025-26</span>
            </h1>
            <p class="text-gray-600 mt-2">Compare Old vs New Tax Regime (AY 2026-27)</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-inputs-results gap-6 lg:gap-8">
            <div>
                <div class="section-container">
                    <h2 class="section-title">Basic Information</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="input-label">Taxpayer Category</label>
                            <select name="taxpayerCategory" id="taxpayerCategory" class="input-field">
                                <option value="individual" selected>Individual (<60)</option>
                                <option value="senior">Senior Citizen (60-79)</option>
                                <option value="super_senior">Super Senior (80+)</option>
                            </select>
                        </div>
                        <div>
                            <label class="input-label">Residential Status</label>
                            <select name="residentialStatus" id="residentialStatus" class="input-field">
                                <option value="resident" selected>Resident</option>
                                <option value="nri">Non-Resident (NRI)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="section-container">
                    <h2 class="section-title">Income Details (₹ per Annum)</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="grossSalary" class="input-label">Gross Salary</label>
                            <input type="number" id="grossSalary" placeholder="e.g., 1500000" class="input-field" min="0">
                        </div>
                        <div>
                            <label for="otherIncome" class="input-label">Income from Other Sources
                                <span class="info-icon">?
                                    <span class="tooltip">Includes Savings Interest, FD Interest, Dividends etc. Enter total amount.</span>
                                </span>
                            </label>
                            <input type="number" id="otherIncome" placeholder="e.g., 25000" class="input-field" min="0">
                        </div>
                    </div>
                 </div>

                 <div class="section-container">
                     <h2 class="section-title">Income from House Property (₹)</h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                         <div>
                             <label for="hpInterestSelf" class="input-label">Interest Paid (Self-Occupied)
                                 <span class="info-icon">?
                                    <span class="tooltip">Interest paid on loan for self-occupied house. Max ₹2,00,000 deduction under Old Regime only.</span>
                                 </span>
                             </label>
                             <input type="number" id="hpInterestSelf" placeholder="Max 200000" class="input-field" min="0">
                         </div>
                         <div class="border border-gray-200 p-3 rounded-md space-y-2 bg-gray-50">
                             <label class="input-label text-gray-600 font-medium">Let-Out Property Details</label>
                             <input type="number" id="hpRentLetOut" placeholder="Annual Rent Received" class="input-field text-sm" min="0">
                             <input type="number" id="hpTaxLetOut" placeholder="Municipal Taxes Paid" class="input-field text-sm" min="0">
                             <input type="number" id="hpInterestLetOut" placeholder="Interest Paid on Loan" class="input-field text-sm" min="0">
                         </div>
                     </div>
                 </div>

                <div class="section-container">
                    <h2 class="section-title">Deductions <span class="text-sm font-normal text-gray-500">(Primarily for Old Regime)</span></h2>
                    <div class="deductions-content-visible" id="deductionsContent">
                        <h3 class="deduction-group-title">Investments & Savings (Sec 80C, 80CCD)</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="deduction80C" class="input-label">Sec 80C
                                     <span class="info-icon">?
                                        <span class="tooltip">Includes EPF, PPF, ELSS, Life Insurance Premium, Home Loan Principal, Tuition Fees etc. Max limit ₹1,50,000 (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80C" placeholder="Max 150000" class="input-field" min="0">
                            </div>
                             <div>
                                <label for="deduction80CCD1B" class="input-label">Sec 80CCD(1B) - NPS Self
                                     <span class="info-icon">?
                                        <span class="tooltip">Additional deduction for self-contribution to NPS. Max limit ₹50,000 (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80CCD1B" placeholder="Max 50000" class="input-field" min="0">
                            </div>
                             <div>
                                <label for="deduction80CCD2" class="input-label">Sec 80CCD(2) - Employer NPS
                                     <span class="info-icon">?
                                        <span class="tooltip">Employer's contribution to NPS. Limit is 10% of salary (Basic+DA) for private employees, 14% for govt employees. Deduction ALLOWED IN BOTH REGIMES. Enter the contributed amount.</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80CCD2" placeholder="e.g., 50000" class="input-field" min="0">
                            </div>
                            <div>
                                <label for="deduction80TTA" class="input-label">Sec 80TTA/TTB - Savings Interest
                                     <span class="info-icon">?
                                        <span class="tooltip">Deduction on interest from Savings A/c (80TTA, Max ₹10k, non-seniors) or Savings & Deposits (80TTB, Max ₹50k, seniors). Old Regime Only. Enter total eligible interest received; calculator applies the limit.</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80TTA" placeholder="Total Savings Interest" class="input-field" min="0">
                            </div>
                        </div>

                        <h3 class="deduction-group-title">Health & Insurance</h3>
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                           <div>
                                <label for="deduction80D" class="input-label">Sec 80D - Health Insurance Premium
                                     <span class="info-icon">?
                                        <span class="tooltip">Premium for self/family & parents. Limits depend on age. Enter total deductible amount (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80D" placeholder="e.g., 25000" class="input-field" min="0">
                            </div>
                        </div>

                        <h3 class="deduction-group-title">Housing & Allowances</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                           <div>
                                <label for="hraExemption" class="input-label">HRA Exemption Claimed
                                    <span class="info-icon">?
                                        <span class="tooltip">Calculated House Rent Allowance exemption based on salary, rent paid, and location (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="hraExemption" placeholder="e.g., 120000" class="input-field" min="0">
                            </div>
                             <div>
                                <label for="ltaExemption" class="input-label">LTA Exemption Claimed
                                     <span class="info-icon">?
                                        <span class="tooltip">Leave Travel Allowance exemption based on actual travel costs, subject to conditions (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="ltaExemption" placeholder="e.g., 20000" class="input-field" min="0">
                            </div>
                        </div>

                         <h3 class="deduction-group-title">Other Deductions</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="professionalTax" class="input-label">Professional Tax Paid
                                     <span class="info-icon">?
                                        <span class="tooltip">Amount paid as professional tax levied by state govt. Max deduction ₹2,500 (Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="professionalTax" placeholder="Max 2500" class="input-field" min="0">
                            </div>
                             <div>
                                <label for="deduction80E" class="input-label">Sec 80E - Edu Loan Interest
                                     <span class="info-icon">?
                                        <span class="tooltip">Interest paid on loan for higher education for self, spouse, children or student for whom you are legal guardian (Old Regime Only). No upper limit on amount.</span>
                                    </span>
                                </label>
                                <input type="number" id="deduction80E" placeholder="e.g., 30000" class="input-field" min="0">
                            </div>
                             <div>
                                <label for="otherDeductions" class="input-label">Other Chapter VI-A Deductions
                                     <span class="info-icon">?
                                        <span class="tooltip">Combine other deductions like 80G (Donations), 80U (Disability), 80DD, 80DDB etc. (Mostly Old Regime Only).</span>
                                    </span>
                                </label>
                                <input type="number" id="otherDeductions" placeholder="e.g., 10000" class="input-field" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="calculateBtn" class="calculate-button">Calculate Tax Liability</button>
                </div>
            </div>

            <div id="resultsSection" class="space-y-6">
                <div id="resultsPlaceholder" class="text-center text-gray-500 p-10 bg-white rounded-xl shadow-lg h-full flex items-center justify-center">
                    <p>Your tax comparison will appear here after calculation.</p>
                </div>

                <div id="resultsOutput" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="oldRegimeCard" class="result-card result-card-old">
                        <div id="oldRecBadge" class="recommended-badge hidden">Recommended</div>
                        <h3 class="result-title">Old Tax Regime</h3>
                        <div class="space-y-1.5 text-sm">
                            <div class="flex justify-between"><span class="result-label">Gross Total Income:</span> <span class="result-value" id="oldGti">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">Total Deductions:</span> <span class="result-value" id="oldDeductions">₹ 0</span></div>
                            <div class="flex justify-between font-medium"><span class="result-label">Net Taxable Income:</span> <span class="result-value" id="oldNti">₹ 0</span></div>
                            <hr class="my-2">
                            <div class="flex justify-between"><span class="result-label">Income Tax Calc:</span> <span class="result-value" id="oldTax">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(-) Rebate u/s 87A:</span> <span class="result-value" id="oldRebate">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">Tax After Rebate:</span> <span class="result-value" id="oldTaxAfterRebate">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(+) Surcharge:</span> <span class="result-value" id="oldSurcharge">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(+) Health & Edu Cess (4%):</span> <span class="result-value" id="oldCess">₹ 0</span></div>
                            <hr class="my-3 border-t-2 border-gray-300">
                            <div class="flex justify-between items-center mt-2">
                                <span class="total-tax-label">Total Tax Payable:</span>
                                <span class="total-tax-value" id="oldTotalTax">₹ 0</span>
                            </div>
                        </div>
                    </div>

                    <div id="newRegimeCard" class="result-card result-card-new">
                         <div id="newRecBadge" class="recommended-badge hidden">Recommended</div>
                        <h3 class="result-title">New Tax Regime (FY 25-26)</h3>
                         <div class="space-y-1.5 text-sm">
                            <div class="flex justify-between"><span class="result-label">Gross Total Income:</span> <span class="result-value" id="newGti">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">Total Deductions:</span> <span class="result-value" id="newDeductions">₹ 0</span></div>
                             <div class="flex justify-between font-medium"><span class="result-label">Net Taxable Income:</span> <span class="result-value" id="newNti">₹ 0</span></div>
                             <hr class="my-2">
                            <div class="flex justify-between"><span class="result-label">Income Tax Calc:</span> <span class="result-value" id="newTax">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(-) Rebate u/s 87A:</span> <span class="result-value" id="newRebate">₹ 0</span></div>
                             <div class="flex justify-between"><span class="result-label">Tax After Rebate:</span> <span class="result-value" id="newTaxAfterRebate">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(+) Surcharge:</span> <span class="result-value" id="newSurcharge">₹ 0</span></div>
                            <div class="flex justify-between"><span class="result-label">(+) Health & Edu Cess (4%):</span> <span class="result-value" id="newCess">₹ 0</span></div>
                             <hr class="my-3 border-t-2 border-gray-300">
                             <div class="flex justify-between items-center mt-2">
                                <span class="total-tax-label">Total Tax Payable:</span>
                                <span class="total-tax-value" id="newTotalTax">₹ 0</span>
                            </div>
                        </div>
                    </div>
                </div>
                 <div id="recommendation" class="hidden text-center mt-2 p-4 border text-base rounded-lg font-semibold">
                    </div>
            </div>
        </div>

        <footer class="mt-10 pt-6 border-t border-gray-300 text-center text-xs text-gray-500">
            <strong>Disclaimer:</strong> This calculator provides an estimate based on the announced rules for FY 2025-26 (AY 2026-27) as understood from Budget 2025 communications. Tax laws are subject to change and final notification by the CBDT. Figures are indicative only and do not constitute financial advice. Please consult a qualified tax professional for accurate calculations and tax planning. House property loss calculations and certain complex deductions might be simplified.
        </footer>
    </div>

    <script>
        // --- Helper Functions ---
        const $ = (selector) => document.querySelector(selector);
        const getVal = (id) => parseFloat($(`#${id}`).value) || 0;
        const getSelectVal = (id) => $(`#${id}`).value; // For select dropdowns
        const formatCurrency = (num) => `₹ ${num.toLocaleString('en-IN', { maximumFractionDigits: 0 })}`;

        // --- Accordion Logic Removed ---
        // No JavaScript needed for accordion functionality anymore

        // --- Tax Calculation Logic (Core logic remains largely the same) ---

        // Calculate Income from House Property (Simplified)
        function calculateHousePropertyIncome(rent, municipalTax, interestLetOut, interestSelf) {
            const netAnnualValue = Math.max(0, rent - municipalTax);
            const standardDeductionHP = netAnnualValue * 0.30;
            const incomeLetOut = netAnnualValue - standardDeductionHP - interestLetOut;
            const lossSelfOccupied = Math.min(interestSelf, 200000);
            return { incomeLetOut, lossSelfOccupied };
        }

        // Calculate Surcharge
        function calculateSurcharge(taxableIncome, taxAmount, regime) {
            if (taxAmount <= 0) return 0;
            let surchargeRate = 0;
            const income = taxableIncome; // Use taxableIncome for surcharge calculation
            if (regime === 'old') {
                // Old Regime Surcharge Rates
                if (income > 50000000) surchargeRate = 0.37; // Above 5 Cr
                else if (income > 20000000) surchargeRate = 0.25; // 2 Cr to 5 Cr
                else if (income > 10000000) surchargeRate = 0.15; // 1 Cr to 2 Cr
                else if (income > 5000000) surchargeRate = 0.10;  // 50 L to 1 Cr
            } else { // New Regime (FY 2025-26) Surcharge Rates
                 if (income > 20000000) surchargeRate = 0.25; // Above 2 Cr (Max 25%)
                 else if (income > 10000000) surchargeRate = 0.15; // 1 Cr to 2 Cr
                 else if (income > 5000000) surchargeRate = 0.10;  // 50 L to 1 Cr
            }
            // Apply surcharge on the tax amount
            return taxAmount * surchargeRate;
        }


        // Calculate Tax based on Slabs
        function calculateTaxOnSlabs(income, slabs) {
            let tax = 0;
            // Iterate slabs from lowest to highest limit
            for (let i = 0; i < slabs.length; i++) {
                const [lowerLimit, upperLimit, rate] = slabs[i];
                if (income > lowerLimit) {
                    // Calculate the income falling within this slab
                    const taxableInSlab = Math.min(income, upperLimit) - lowerLimit;
                     // Add tax for this slab's income
                    tax += taxableInSlab * rate;
                }
                 // If income doesn't exceed the upper limit of this slab, stop.
                 if (income <= upperLimit) {
                     break;
                 }
            }
            return tax;
        }


        // --- Old Regime Calculation ---
        function calculateOldRegimeTax(inputs) {
            const { category, resident, grossSalary, otherIncome, hpIncome, deductions } = inputs;

            // 1. Calculate Gross Total Income (GTI)
            let gti = grossSalary + otherIncome;
            let hpNetIncome = hpIncome.incomeLetOut - hpIncome.lossSelfOccupied;
            if (hpNetIncome < 0) {
                 hpNetIncome = Math.max(hpNetIncome, -200000); // Cap loss set-off
            }
            gti += hpNetIncome;
            gti = Math.max(0, gti);

            // 2. Calculate Deductions
            const standardDeduction = grossSalary > 0 ? 50000 : 0;
            const profTax = Math.min(deductions.professionalTax, 2500);

            // Adjust 80TTA/TTB based on age and input value (which is total interest)
            const isSenior = category === 'senior' || category === 'super_senior';
            let savingsInterestDeduction = 0;
            if (isSenior) {
                // 80TTB for seniors on savings & deposit interest
                savingsInterestDeduction = Math.min(deductions.savingsInterestInput, 50000);
            } else {
                // 80TTA for non-seniors on savings interest only
                 savingsInterestDeduction = Math.min(deductions.savingsInterestInput, 10000);
            }

            // Sum Chapter VI-A deductions applying caps
            let chapter6a = Math.min(deductions.sec80C, 150000) +
                            Math.min(deductions.sec80CCD1B, 50000) +
                            deductions.sec80D + // Assuming user enters valid 80D amount
                            deductions.sec80E +
                            savingsInterestDeduction + // Use calculated TTA/TTB
                            deductions.sec80CCD2 + // Cap based on salary % should ideally be done
                            deductions.otherDeductions;

            const totalDeductions = standardDeduction + deductions.hraExemption + deductions.ltaExemption + profTax + chapter6a;

            // 3. Net Taxable Income (NTI)
            const nti = Math.max(0, gti - totalDeductions);

            // 4. Calculate Tax based on Slabs (Old Regime)
             let slabs;
             // Format: [Lower Limit, Upper Limit (exclusive for calc), Rate]
             // Using Infinity for the last upper limit simplifies the loop in calculateTaxOnSlabs
             if (category === 'super_senior') { // 80+
                 slabs = [
                     [0, 500000, 0],
                     [500000, 1000000, 0.20],
                     [1000000, Infinity, 0.30]
                 ];
             } else if (category === 'senior') { // 60-79
                 slabs = [
                     [0, 300000, 0],
                     [300000, 500000, 0.05],
                     [500000, 1000000, 0.20],
                     [1000000, Infinity, 0.30]
                 ];
             } else { // Below 60 or NRI
                 slabs = [
                     [0, 250000, 0],
                     [250000, 500000, 0.05],
                     [500000, 1000000, 0.20],
                     [1000000, Infinity, 0.30]
                 ];
             }
             const incomeTax = calculateTaxOnSlabs(nti, slabs);


            // 5. Rebate u/s 87A
            let rebate = 0;
            if (resident && nti <= 500000) {
                rebate = Math.min(incomeTax, 12500);
            }
            const taxAfterRebate = Math.max(0, incomeTax - rebate);

            // 6. Surcharge
            const surcharge = calculateSurcharge(nti, taxAfterRebate, 'old');

            // 7. Cess
            const cess = (taxAfterRebate + surcharge) * 0.04;

            // 8. Total Tax
            const totalTax = taxAfterRebate + surcharge + cess;

            return { gti, totalDeductions, nti, incomeTax, rebate, taxAfterRebate, surcharge, cess, totalTax };
        }

        // --- New Regime Calculation (FY 2025-26) ---
        function calculateNewRegimeTax(inputs) {
             const { resident, grossSalary, otherIncome, hpIncome, deductions } = inputs;

            // 1. Calculate Gross Total Income (GTI)
            let gti = grossSalary + otherIncome;
            let hpNetIncome = hpIncome.incomeLetOut; // Only let-out income considered
            if (hpNetIncome < 0) {
                hpNetIncome = 0; // Loss cannot be set off
            }
            gti += hpNetIncome;
            gti = Math.max(0, gti);

            // 2. Calculate Deductions Allowed
            const standardDeduction = grossSalary > 0 ? 75000 : 0;
            const employerNps = deductions.sec80CCD2; // Cap based on salary % should ideally be done
            // Add Family Pension Deduction if applicable (Not included in inputs, assuming 0)
            const totalDeductions = standardDeduction + employerNps;

            // 3. Net Taxable Income (NTI)
            const nti = Math.max(0, gti - totalDeductions);

            // 4. Calculate Tax based on Slabs (New Regime FY 2025-26)
             const slabs = [
                 [0, 400000, 0],
                 [400000, 800000, 0.05],
                 [800000, 1200000, 0.10],
                 [1200000, 1600000, 0.15],
                 [1600000, 2000000, 0.20],
                 [2000000, 2400000, 0.25],
                 [2400000, Infinity, 0.30]
             ];
             const incomeTax = calculateTaxOnSlabs(nti, slabs);

            // 5. Rebate u/s 87A
            let rebate = 0;
             if (resident && nti <= 1200000) { // Increased Rebate Limit
                 // Full rebate makes tax effectively zero up to 12L NTI.
                 rebate = incomeTax;
                 // Note: Precise marginal relief calculation for income slightly above 12L is complex and omitted here.
             }
             const taxAfterRebate = Math.max(0, incomeTax - rebate);

            // 6. Surcharge (New Regime Rates - Max 25%)
            const surcharge = calculateSurcharge(nti, taxAfterRebate, 'new');

            // 7. Cess
            const cess = (taxAfterRebate + surcharge) * 0.04;

            // 8. Total Tax
            const totalTax = taxAfterRebate + surcharge + cess;

             return { gti, totalDeductions, nti, incomeTax, rebate, taxAfterRebate, surcharge, cess, totalTax };
        }


        // --- Event Listener & Display Logic ---
        $('#calculateBtn').addEventListener('click', () => {
            // Gather Inputs
            const inputs = {
                category: getSelectVal('taxpayerCategory'),
                resident: getSelectVal('residentialStatus') === 'resident',
                grossSalary: getVal('grossSalary'),
                otherIncome: getVal('otherIncome'),
                hpIncome: calculateHousePropertyIncome(
                    getVal('hpRentLetOut'),
                    getVal('hpTaxLetOut'),
                    getVal('hpInterestLetOut'),
                    getVal('hpInterestSelf')
                ),
                deductions: {
                    sec80C: getVal('deduction80C'),
                    sec80CCD1B: getVal('deduction80CCD1B'),
                    sec80D: getVal('deduction80D'),
                    sec80E: getVal('deduction80E'),
                    savingsInterestInput: getVal('deduction80TTA'), // Get the raw interest input
                    hraExemption: getVal('hraExemption'),
                    ltaExemption: getVal('ltaExemption'),
                    professionalTax: getVal('professionalTax'),
                    sec80CCD2: getVal('deduction80CCD2'),
                    otherDeductions: getVal('otherDeductions')
                }
            };

             // Perform Calculations
            const oldResult = calculateOldRegimeTax(inputs);
            const newResult = calculateNewRegimeTax(inputs);

            // Display Results
            $('#resultsPlaceholder').classList.add('hidden');
            $('#resultsOutput').classList.remove('hidden');
            $('#resultsOutput').classList.add('grid');
            $('#recommendation').classList.remove('hidden');

            // Populate Old Regime Card
            $('#oldGti').textContent = formatCurrency(oldResult.gti);
            $('#oldDeductions').textContent = formatCurrency(oldResult.totalDeductions);
            $('#oldNti').textContent = formatCurrency(oldResult.nti);
            $('#oldTax').textContent = formatCurrency(oldResult.incomeTax);
            $('#oldRebate').textContent = formatCurrency(oldResult.rebate);
            $('#oldTaxAfterRebate').textContent = formatCurrency(oldResult.taxAfterRebate);
            $('#oldSurcharge').textContent = formatCurrency(oldResult.surcharge);
            $('#oldCess').textContent = formatCurrency(oldResult.cess);
            $('#oldTotalTax').textContent = formatCurrency(oldResult.totalTax);

            // Populate New Regime Card
            $('#newGti').textContent = formatCurrency(newResult.gti);
            $('#newDeductions').textContent = formatCurrency(newResult.totalDeductions);
            $('#newNti').textContent = formatCurrency(newResult.nti);
            $('#newTax').textContent = formatCurrency(newResult.incomeTax);
            $('#newRebate').textContent = formatCurrency(newResult.rebate);
            $('#newTaxAfterRebate').textContent = formatCurrency(newResult.taxAfterRebate);
            $('#newSurcharge').textContent = formatCurrency(newResult.surcharge);
            $('#newCess').textContent = formatCurrency(newResult.cess);
            $('#newTotalTax').textContent = formatCurrency(newResult.totalTax);

             // Highlight Recommended Regime & Set Recommendation Text
            const oldCard = $('#oldRegimeCard');
            const newCard = $('#newRegimeCard');
            const oldRecBadge = $('#oldRecBadge');
            const newRecBadge = $('#newRecBadge');
            const recommendationDiv = $('#recommendation');

            oldCard.classList.remove('result-recommended');
            newCard.classList.remove('result-recommended');
            oldRecBadge.classList.add('hidden');
            newRecBadge.classList.add('hidden');

            recommendationDiv.classList.remove('bg-green-100', 'border-robinhood-green', 'text-green-800', 'bg-blue-100', 'border-blue-500', 'text-blue-800', 'bg-gray-100', 'border-gray-400', 'text-gray-700'); // Clear previous styles


            if (newResult.totalTax < oldResult.totalTax) {
                newCard.classList.add('result-recommended');
                newRecBadge.classList.remove('hidden');
                const savings = oldResult.totalTax - newResult.totalTax;
                recommendationDiv.innerHTML = `Choosing the <strong>New Tax Regime</strong> could save you <strong class="text-robinhood-green">${formatCurrency(savings)}</strong>.`;
                 recommendationDiv.classList.add('bg-green-100', 'border-robinhood-green', 'text-green-800');
            } else if (oldResult.totalTax < newResult.totalTax) {
                oldCard.classList.add('result-recommended');
                oldRecBadge.classList.remove('hidden');
                 const savings = newResult.totalTax - oldResult.totalTax;
                 recommendationDiv.innerHTML = `Choosing the <strong>Old Tax Regime</strong> could save you <strong class="text-blue-600">${formatCurrency(savings)}</strong>.`;
                 recommendationDiv.classList.add('bg-blue-100', 'border-blue-500', 'text-blue-800');
            } else {
                 recommendationDiv.textContent = `Both regimes result in the same tax liability (${formatCurrency(newResult.totalTax)}).`;
                 recommendationDiv.classList.add('bg-gray-100', 'border-gray-400', 'text-gray-700');
            }
        });

    </script>
</body>
</html>
